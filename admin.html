<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hotel Menu Admin Panel</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1200px; margin: auto; }
        .panel { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2 { color: #128C7E; border-bottom: 2px solid #eee; padding-bottom: 10px;}
        input, select, button { padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        button { background-color: #25D366; color: white; cursor: pointer; border: none; padding: 10px 20px; }
        .delete-btn { background-color: #dc3545; }
        #menu-display ul { list-style: none; padding: 0; }
        #menu-display li { background: #e9ecef; margin: 5px 0; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 4px; }
        table { width:100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align:left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        #live-orders-body tr:first-child { background-color: #fffbe6; font-weight: bold;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Hotel Bot - Admin Dashboard</h1>
        
        <div class="panel">
            <h2>ðŸ”´ Live Orders</h2>
            <table id="live-orders-table">
                <thead><tr><th>Time</th><th>Customer</th><th>Order Details</th><th>Total</th></tr></thead>
                <tbody id="live-orders-body"></tbody>
            </table>
        </div>

        <div class="panel" id="menu-display">
            <h2>Menu Management</h2>
            <div id="menu-content"></div>
        </div>

        <div class="panel">
            <h2>Add New Category</h2>
            <form id="add-category-form">
                <input type="text" id="cat-id" placeholder="Category ID (e.g., drinks)" required>
                <input type="text" id="cat-title" placeholder="Category Title (e.g., Beverages)" required>
                <button type="submit">Add Category</button>
            </form>
        </div>

        <div class="panel">
            <h2>Add New Item</h2>
            <form id="add-item-form">
                <select id="item-category" required></select>
                <input type="text" id="item-name" placeholder="Item Name" required>
                <input type="number" id="item-price" placeholder="Price" required>
                <button type="submit">Add Item</button>
            </form>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // --- Live Order Logic ---
        const socket = io();
        const ordersTableBody = document.getElementById('live-orders-body');
        
        socket.on('new-order', (order) => {
            const row = document.createElement('tr');
            let itemsHtml = '';
            order.cart.forEach(item => { itemsHtml += `<div>- ${item.name}</div>`; });
            
            row.innerHTML = `<td>${order.time}</td><td>${order.customer}<br><strong>Address:</strong> ${order.address}</td><td>${itemsHtml}</td><td><strong>Rs. ${order.total}</strong></td>`;
            ordersTableBody.prepend(row);
        });

        // --- Menu Management Logic ---
        document.addEventListener('DOMContentLoaded', fetchMenu);
        async function fetchMenu() { /* ... Paste fetchMenu logic here ... */ }
        document.getElementById('add-category-form').addEventListener('submit', async (e) => { /* ... Paste form logic here ... */ });
        document.getElementById('add-item-form').addEventListener('submit', async (e) => { /* ... Paste form logic here ... */ });
        async function deleteItem(catId, itemId) { /* ... Paste delete logic here ... */ }
        async function deleteCategory(catId) { /* ... Paste delete logic here ... */ }

        // Pasting full menu logic for completeness
        async function fetchMenu() {
            try {
                const response = await fetch('/api/menu');
                const menu = await response.json();
                const menuContent = document.getElementById('menu-content');
                const categorySelect = document.getElementById('item-category');
                menuContent.innerHTML = ''; categorySelect.innerHTML = '<option value="">Select a category</option>';
                for (const catId in menu) {
                    const category = menu[catId];
                    menuContent.innerHTML += `<h3>${category.title} <button class="delete-btn" onclick="deleteCategory('${catId}')">X</button></h3>`;
                    const ul = document.createElement('ul');
                    if (category.items.length === 0) { ul.innerHTML = '<li>No items.</li>'; } 
                    else { category.items.forEach(item => { ul.innerHTML += `<li>${item.name} (Rs. ${item.price}) <button class="delete-btn" onclick="deleteItem('${catId}', '${item.id}')">X</button></li>`; }); }
                    menuContent.appendChild(ul);
                    categorySelect.innerHTML += `<option value="${catId}">${category.title}</option>`;
                }
            } catch (error) { console.error("Failed to fetch menu:", error); }
        }
        document.getElementById('add-category-form').addEventListener('submit', async (e) => { e.preventDefault(); const id = document.getElementById('cat-id').value.trim(); const title = document.getElementById('cat-title').value.trim(); if (!id || !title) return; await fetch('/api/category', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id, title }) }); fetchMenu(); e.target.reset(); });
        document.getElementById('add-item-form').addEventListener('submit', async (e) => { e.preventDefault(); const categoryId = document.getElementById('item-category').value; const name = document.getElementById('item-name').value.trim(); const price = parseInt(document.getElementById('item-price').value, 10); if (!categoryId || !name || !price) return; await fetch('/api/item', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ categoryId, name, price }) }); fetchMenu(); e.target.reset(); });
        async function deleteItem(categoryId, itemId) { if (confirm('Delete this item?')) { await fetch(`/api/item/${categoryId}/${itemId}`, { method: 'DELETE' }); fetchMenu(); } }
        async function deleteCategory(categoryId) { if (confirm('Delete this entire category?')) { await fetch(`/api/category/${categoryId}`, { method: 'DELETE' }); fetchMenu(); } }
    </script>
</body>
</html>
